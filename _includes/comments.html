<section>
    {% assign comments_subfolder = page.url | slugify %}
    {% assign comment_files = site.data.comments[comments_subfolder] %}
    {% assign comments = '' | split: '' %}
    {% for comment_file in comment_files %}
        {% assign comment = comment_file[1] %}
        {% assign comments = comments | push: comment %}
    {% endfor %}
    {% assign comments = comments | sort: 'date' %}

    <h2>Kommentare ({{ comment_files.size | default: 0 }})</h2>

    <div id="comments">
    {% for comment in comments %}
        {% include comment.html name=comment.name message=comment.message date=comment.date %}
    {% endfor %}
    </div>
    
    <h3>Kommentar abgeben</h3>

    <form id="comment-form" autocomplete="off" method="POST" action="https://elis-blog-backend.fly.dev/v3/entry/github/elias-gander/elias-gander.github.io/main/comments">
        <input name="options[redirect]" type="hidden" value="{{ '/danke' | absolute_url }}">

        <input name="options[slug]" type="hidden" value="{{ comments_subfolder }}">
        <input name="fields[name]" placeholder="Dein Name" type="text" required>
        <textarea name="fields[message]" placeholder="Dein Kommentar"></textarea>

        <button class="g-recaptcha" data-sitekey="6Ld501MpAAAAACnG_v6PjIQzJX08Fw5OWb8rmYu2" data-callback="onSubmit">Absenden</button>

        <input type="hidden" name="options[reCaptcha][siteKey]" value="6Ld501MpAAAAACnG_v6PjIQzJX08Fw5OWb8rmYu2">
        <input type="hidden" name="options[reCaptcha][secret]" value="Wq7oWYWvqiey2Z1y1SbTNFCK+Vv2/fNreCG1Cv/M8NMe9mbcCzysEHqbL0bxCeesu4nE8pESkID4yTa4Ig7WqMGeKJCxcmdhMUohKh9sytOnITgZLgOgXgU3BLuM2POyyTQzZ+MGmct74sDONrTaGSY21KqAd0Jpk0oqNurS0EH/y4TGhyajqY5LHk29C6Dzzh8VdWo24g+Fm25Ylwi3shygg6bWGWafCygES1qUgQuVAgEsB1ZJivf/X8TEbLNl/YmwJO07FwNNsyk69GjqAWVHC9f0PbCevW+Zh7SAGTyZHlBKI1AFtGnQG+xAi5WtOWB0+dzsT2wMFxHhXig52A==">
    </form>

    <div id="recaptcha-branding">
        This site is protected by reCAPTCHA and the Google
        <a href="https://policies.google.com/privacy">Privacy Policy</a> and
        <a href="https://policies.google.com/terms">Terms of Service</a> apply.
    </div>  
</section>

<script src="https://www.google.com/recaptcha/api.js" async defer></script>
<script>
    function onSubmit(token) {
      document.getElementById("comment-form").submit();
    }
  </script>

<style>
    textarea {
        resize: vertical; 
        display: block; 
        width: 100%; 
        height: 100px; 
    }

    input, textarea, button {
        font-family: monospace;
        font-size: 16px;
        margin-bottom: 1rem;
    }

    .grecaptcha-badge { 
        visibility: hidden !important;
    }

    #recaptcha-branding {
        font-size: 75%;
        opacity: 0.3;
    }
</style>
